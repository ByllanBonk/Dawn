{%- comment -%}
  GK About Gallery Section
  - Old site layout: Big title + large centered main image + credit
  - Adds 4 thumbnail images that open fullscreen lightbox (like old site)
  - New site motion: depth slide image + staggered text reveal
  - Self-contained CSS + JS, scoped to section.id
{%- endcomment -%}

{%- liquid
  assign eyebrow = section.settings.eyebrow | strip
  assign heading = section.settings.heading | strip
  assign body = section.settings.body
  assign credit = section.settings.photo_credit | strip

  assign t1c = section.settings.thumb_1_credit | strip
  assign t2c = section.settings.thumb_2_credit | strip
  assign t3c = section.settings.thumb_3_credit | strip
  assign t4c = section.settings.thumb_4_credit | strip
-%}

<section
  id="GK-AboutGallery-{{ section.id }}"
  class="gk-aboutg"
  data-gk-anim="{{ section.settings.enable_animation }}"
>
  <div class="page-width gk-aboutg__inner">

    {%- if eyebrow != blank and eyebrow != '.' -%}
      <div class="gk-aboutg__eyebrow">{{ eyebrow }}</div>
    {%- endif -%}

    {%- if heading != blank and heading != '.' -%}
      <h2 class="gk-aboutg__heading">{{ heading }}</h2>
    {%- endif -%}

    {%- if section.settings.main_image != blank -%}
      {%- liquid
        assign img = section.settings.main_image
        assign img_h = img.width | divided_by: img.aspect_ratio
        assign main_full = img | image_url: width: 2400
      -%}

      <figure class="gk-aboutg__figure" aria-label="{{ heading | escape }}">
        <button
          type="button"
          class="gk-aboutg__media gk-aboutg__open"
          data-gk-full="{{ main_full }}"
          data-gk-alt="{{ heading | escape }}"
          aria-label="Open image"
        >
          {{
            img
            | image_url: width: 2400
            | image_tag:
              width: img.width,
              height: img_h,
              loading: 'lazy',
              widths: '600, 900, 1200, 1600, 2000, 2400',
              sizes: '(min-width: 990px) 1100px, (min-width: 750px) 90vw, 92vw',
              class: 'gk-aboutg__img'
          }}
        </button>

        {%- if credit != blank and credit != '.' -%}
          <figcaption class="gk-aboutg__credit">
            {{ credit }}
          </figcaption>
        {%- endif -%}
      </figure>
    {%- endif -%}

    {%- comment -%} Thumbnail row (4 images) {%- endcomment -%}
    {%- assign thumbs_exist = false -%}
    {%- if section.settings.thumb_1 != blank or section.settings.thumb_2 != blank or section.settings.thumb_3 != blank or section.settings.thumb_4 != blank -%}
      {%- assign thumbs_exist = true -%}
    {%- endif -%}

    {%- if thumbs_exist -%}
      <div class="gk-aboutg__thumbs" aria-label="Gallery thumbnails">
        {%- for i in (1..4) -%}
          {%- liquid
            assign key = 'thumb_' | append: i
            assign img_t = section.settings[key]
          -%}

          {%- if img_t != blank -%}
            {%- liquid
              assign full = img_t | image_url: width: 2400
              assign alt = section.settings.heading | default: 'Gallery image'
              assign th = img_t.width | divided_by: img_t.aspect_ratio
            -%}
            <button
              type="button"
              class="gk-aboutg__thumb gk-aboutg__open"
              data-gk-full="{{ full }}"
              data-gk-alt="{{ alt | escape }}"
              aria-label="Open gallery image {{ i }}"
            >
              {{
                img_t
                | image_url: width: 700
                | image_tag:
                  width: img_t.width,
                  height: th,
                  loading: 'lazy',
                  widths: '240, 360, 480, 600, 700',
                  sizes: '(min-width: 990px) 250px, (min-width: 750px) 22vw, 42vw',
                  class: 'gk-aboutg__thumbimg'
              }}
            </button>
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- endif -%}

    {%- if body != blank -%}
      <div class="gk-aboutg__content rte">
        {{ body }}
      </div>
    {%- endif -%}

  </div>

  {%- comment -%} Lightbox (scoped, injected once per section) {%- endcomment -%}
  <div class="gk-aboutg__lightbox" hidden aria-hidden="true">
    <div class="gk-aboutg__lb-backdrop" data-gk-close></div>
    <div class="gk-aboutg__lb-panel" role="dialog" aria-modal="true" aria-label="Image viewer">
      <button type="button" class="gk-aboutg__lb-close" aria-label="Close" data-gk-close>×</button>
      <img class="gk-aboutg__lb-img" alt="" />
      <div class="gk-aboutg__lb-credit" hidden></div>
    </div>
  </div>

  <style>
    /* ============================
      GK About Gallery (scoped)
      ============================ */
    #GK-AboutGallery-{{ section.id }}.gk-aboutg {
      --accent: {{ section.settings.accent }};
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.66);
      --line: rgba(255,255,255,0.10);
      --card: rgba(255,255,255,0.06);

      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }

    #GK-AboutGallery-{{ section.id }} .gk-aboutg__inner {
      max-width: 1100px;
      margin: 0 auto;
    }

    /* Title styling (make it match the big “GREG KOCH DATES” vibe) */
    #GK-AboutGallery-{{ section.id }} .gk-aboutg__heading {
      margin: 0 0 18px 0;
      font-weight: 800;
      line-height: 1.02;
      letter-spacing: .02em;
      text-transform: uppercase;
      font-size: clamp(34px, 5.2vw, 64px);
    }

    #GK-AboutGallery-{{ section.id }} .gk-aboutg__eyebrow {
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 10px;
    }

    /* Main image */
    #GK-AboutGallery-{{ section.id }} .gk-aboutg__figure { margin: 0; }

    #GK-AboutGallery-{{ section.id }} .gk-aboutg__media {
      display: block;
      width: 100%;
      border: 0;
      padding: 0;
      background: transparent;
      cursor: zoom-in;
      position: relative;
      overflow: hidden;
      border-radius: 16px;
      border: 1px solid var(--line);
      background: var(--card);
      box-shadow: 0 14px 44px rgba(0,0,0,0.35);
    }

    #GK-AboutGallery-{{ section.id }} .gk-aboutg__img {
      display: block;
      width: 100%;
      height: auto;
      transform: translateZ(0);
    }

    @media (hover: hover) {
      #GK-AboutGallery-{{ section.id }} .gk-aboutg__media {
        transition: transform 160ms ease, border-color 160ms ease, box-shadow 160ms ease;
      }
      #GK-AboutGallery-{{ section.id }} .gk-aboutg__media:hover {
        transform: translateY(-1px);
        border-color: rgba(232,105,10,0.35);
        box-shadow: 0 18px 54px rgba(0,0,0,0.45);
      }
    }

    #GK-AboutGallery-{{ section.id }} .gk-aboutg__credit {
      margin-top: 10px;
      font-style: italic;
      color: var(--muted);
      text-align: right;
    }

    /* Thumbnails row */
    #GK-AboutGallery-{{ section.id }} .gk-aboutg__thumbs {
      margin-top: 16px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    @media (max-width: 749px) {
      #GK-AboutGallery-{{ section.id }} .gk-aboutg__thumbs {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    #GK-AboutGallery-{{ section.id }} .gk-aboutg__thumb {
      border: 1px solid var(--line);
      border-radius: 12px;
      overflow: hidden;
      padding: 0;
      background: rgba(0,0,0,0.22);
      cursor: zoom-in;
      box-shadow: 0 10px 28px rgba(0,0,0,0.28);
    }

    #GK-AboutGallery-{{ section.id }} .gk-aboutg__thumbimg {
      display: block;
      width: 100%;
      height: auto;
    }

    @media (hover: hover) {
      #GK-AboutGallery-{{ section.id }} .gk-aboutg__thumb {
        transition: transform 160ms ease, border-color 160ms ease, box-shadow 160ms ease;
      }
      #GK-AboutGallery-{{ section.id }} .gk-aboutg__thumb:hover {
        transform: translateY(-1px);
        border-color: rgba(232,105,10,0.32);
        box-shadow: 0 14px 36px rgba(0,0,0,0.35);
      }
    }

    /* Body copy */
    #GK-AboutGallery-{{ section.id }} .gk-aboutg__content {
      margin-top: 18px;
      border-top: 1px solid var(--line);
      padding-top: 18px;
      color: var(--text);
    }

    /* ============================
      Motion: Depth Slide + Fly-in
      ============================ */
    #GK-AboutGallery-{{ section.id }}[data-gk-anim="true"] .gk-aboutg__media,
    #GK-AboutGallery-{{ section.id }}[data-gk-anim="true"] .gk-aboutg__thumbs,
    #GK-AboutGallery-{{ section.id }}[data-gk-anim="true"] .gk-aboutg__heading,
    #GK-AboutGallery-{{ section.id }}[data-gk-anim="true"] .gk-aboutg__content {
      opacity: 0;
      transform: translateY(18px);
      will-change: transform, opacity;
    }

    #GK-AboutGallery-{{ section.id }}[data-gk-anim="true"] .gk-aboutg__media {
      transform: translateY(14px) scale(1.04);
    }

    #GK-AboutGallery-{{ section.id }}.gk-in .gk-aboutg__media {
      opacity: 1;
      transform: translateY(0) scale(1);
      transition: opacity 650ms cubic-bezier(.16,.84,.44,1),
                  transform 900ms cubic-bezier(.16,.84,.44,1);
    }

    #GK-AboutGallery-{{ section.id }}.gk-in .gk-aboutg__heading {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 650ms cubic-bezier(.16,.84,.44,1) 140ms,
                  transform 650ms cubic-bezier(.16,.84,.44,1) 140ms;
    }

    #GK-AboutGallery-{{ section.id }}.gk-in .gk-aboutg__thumbs {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 650ms cubic-bezier(.16,.84,.44,1) 200ms,
                  transform 650ms cubic-bezier(.16,.84,.44,1) 200ms;
    }

    #GK-AboutGallery-{{ section.id }}.gk-in .gk-aboutg__content {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 650ms cubic-bezier(.16,.84,.44,1) 260ms,
                  transform 650ms cubic-bezier(.16,.84,.44,1) 260ms;
    }

    @media (prefers-reduced-motion: reduce) {
      #GK-AboutGallery-{{ section.id }}[data-gk-anim="true"] .gk-aboutg__media,
      #GK-AboutGallery-{{ section.id }}[data-gk-anim="true"] .gk-aboutg__thumbs,
      #GK-AboutGallery-{{ section.id }}[data-gk-anim="true"] .gk-aboutg__heading,
      #GK-AboutGallery-{{ section.id }}[data-gk-anim="true"] .gk-aboutg__content {
        opacity: 1 !important;
        transform: none !important;
        transition: none !important;
      }
    }

    /* ============================
      Lightbox
      ============================ */
    #GK-AboutGallery-{{ section.id }} .gk-aboutg__lightbox {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: grid;
      place-items: center;
    }

    #GK-AboutGallery-{{ section.id }} .gk-aboutg__lb-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.82);
      backdrop-filter: blur(6px);
    }

    #GK-AboutGallery-{{ section.id }} .gk-aboutg__lb-panel {
      position: relative;
      width: min(92vw, 1100px);
      max-height: 86vh;
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 16px;
      overflow: hidden;
      background: rgba(10,10,10,0.75);
      box-shadow: 0 24px 80px rgba(0,0,0,0.6);
    }

    #GK-AboutGallery-{{ section.id }} .gk-aboutg__lb-img {
      display: block;
      width: 100%;
      height: auto;
      max-height: 86vh;
      object-fit: contain;
      background: #000;
    }

    #GK-AboutGallery-{{ section.id }} .gk-aboutg__lb-close {
      position: absolute;
      top: 10px;
      right: 12px;
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.35);
      color: rgba(255,255,255,0.9);
      font-size: 26px;
      line-height: 1;
      cursor: pointer;
    }

    @media (hover:hover) {
      #GK-AboutGallery-{{ section.id }} .gk-aboutg__lb-close:hover {
        border-color: rgba(232,105,10,0.35);
        box-shadow: 0 10px 26px rgba(0,0,0,0.35);
      }
    }
  </style>

  <script>
    (function() {
      var root = document.getElementById('GK-AboutGallery-{{ section.id }}');
      if (!root) return;

      // Fly-in reveal
      var animEnabled = root.getAttribute('data-gk-anim') === 'true';
      if (animEnabled) {
        if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          root.classList.add('gk-in');
        } else if ('IntersectionObserver' in window) {
          var revealed = false;
          var reveal = function() {
            if (revealed) return;
            revealed = true;
            root.classList.add('gk-in');
          };
          var io = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
              if (entry.isIntersecting) {
                reveal();
                io.disconnect();
              }
            });
          }, { threshold: 0.25 });
          io.observe(root);
        } else {
          root.classList.add('gk-in');
        }
      }

      // Lightbox
      var lb = root.querySelector('.gk-aboutg__lightbox');
      var lbImg = root.querySelector('.gk-aboutg__lb-img');
      var openers = root.querySelectorAll('.gk-aboutg__open');
      if (!lb || !lbImg || !openers.length) return;

      var open = function(src, alt) {
        lbImg.src = src;
        lbImg.alt = alt || '';
        lb.hidden = false;
        lb.setAttribute('aria-hidden', 'false');
        document.documentElement.style.overflow = 'hidden';
      };

      var close = function() {
        lb.hidden = true;
        lb.setAttribute('aria-hidden', 'true');
        lbImg.src = '';
        document.documentElement.style.overflow = '';
      };

      openers.forEach(function(btn) {
        btn.addEventListener('click', function() {
          var src = btn.getAttribute('data-gk-full');
          var alt = btn.getAttribute('data-gk-alt');
          if (src) open(src, alt);
        });
      });

      lb.querySelectorAll('[data-gk-close]').forEach(function(el) {
        el.addEventListener('click', close);
      });

      document.addEventListener('keydown', function(e) {
        if (!lb.hidden && (e.key === 'Escape' || e.key === 'Esc')) close();
      });
    })();
  </script>
</section>

{% schema %}
{
  "name": "GK About Gallery",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_animation",
      "default": true,
      "label": "Enable fly-in animation"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow (optional)",
      "default": "."
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "About the Koch Marshall Trio"
    },
    {
      "type": "image_picker",
      "id": "main_image",
      "label": "Main image"
    },
    {
      "type": "text",
      "id": "photo_credit",
      "label": "Main photo credit (optional)",
      "default": "above photo credit: ©2025CJFoeckler"
    },

    {
      "type": "header",
      "content": "Thumbnail images (click to expand)"
    },
    {
      "type": "image_picker",
      "id": "thumb_1",
      "label": "Thumbnail 1"
    },
    {
      "type": "image_picker",
      "id": "thumb_2",
      "label": "Thumbnail 2"
    },
    {
      "type": "image_picker",
      "id": "thumb_3",
      "label": "Thumbnail 3"
    },
    {
      "type": "image_picker",
      "id": "thumb_4",
      "label": "Thumbnail 4"
    },

    {
      "type": "richtext",
      "id": "body",
      "label": "Body text",
      "default": "<p>Add your updated copy here. This is editable in the theme editor.</p>"
    },
    {
      "type": "color",
      "id": "accent",
      "label": "Accent color",
      "default": "#E8690A"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 44
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 52
    }
  ],
  "presets": [
    {
      "name": "GK About Gallery"
    }
  ]
}
{% endschema %}