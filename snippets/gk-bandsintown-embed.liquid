{%- comment -%}
  snippets/gk-bandsintown-embed.liquid
  Shared embed for gk-bandsintown-home and gk-bandsintown-page sections.

  Required variables (pass via render):
    bit_wrapper_class    {string}  - 'gk-bit-home' or 'gk-bit-page'
    bit_section_id       {string}  - section.id  (for unique JS targets)
    bit_artist           {string}  - artist name for Bandsintown
    bit_initial_visible  {number}  - events shown on load
    bit_reveal_step      {number}  - events revealed per button click
    bit_more_label       {string}  - label for the show-more button
{%- endcomment -%}

{%- assign _uid = bit_section_id | prepend: 'gkbit-' -%}

<style>
/* ============================================================
   GK Bandsintown embed â€” scoped to .{{ bit_wrapper_class }}
   ============================================================ */

.{{ bit_wrapper_class }} {
  width: 100%;
  box-sizing: border-box;
}

/* --- Hide BIT chrome we don't want --- */
.{{ bit_wrapper_class }} .bit-top-track-header,
.{{ bit_wrapper_class }} .bit-header,
.{{ bit_wrapper_class }} .bit-header-future,
.{{ bit_wrapper_class }} .bit-header-past,
.{{ bit_wrapper_class }} [class*="bit-top"],
.{{ bit_wrapper_class }} [class*="header-future"],
.{{ bit_wrapper_class }} .bit-widget > div > div:first-child img,
.{{ bit_wrapper_class }} .bit-powered-by,
.{{ bit_wrapper_class }} .bit-footer,
.{{ bit_wrapper_class }} .bit-social-share,
.{{ bit_wrapper_class }} .bit-share-button {
  display: none !important;
}

/* Hide RSVP buttons */
.{{ bit_wrapper_class }} .bit-rsvp-pst,
.{{ bit_wrapper_class }} [class*="rsvp"],
.{{ bit_wrapper_class }} a[data-bit-action="rsvp"],
.{{ bit_wrapper_class }} .bit-rsvp-container,
.{{ bit_wrapper_class }} .bit-not-attending-container {
  display: none !important;
}

/* --- Widget root: transparent --- */
.{{ bit_wrapper_class }} .bit-widget,
.{{ bit_wrapper_class }} .bit-widget-container,
.{{ bit_wrapper_class }} .bit-widget > div {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  padding: 0 !important;
  margin: 0 !important;
  font-family: inherit !important;
}

/* --- Event list wrapper --- */
.{{ bit_wrapper_class }} .bit-event-list,
.{{ bit_wrapper_class }} ul.bit-event-list,
.{{ bit_wrapper_class }} .bit-events {
  list-style: none !important;
  margin: 0 !important;
  padding: 0 !important;
  display: flex !important;
  flex-direction: column !important;
  gap: 10px !important;
}

/* --- Each event row: glass card --- */
.{{ bit_wrapper_class }} .bit-event,
.{{ bit_wrapper_class }} li.bit-event {
  list-style: none !important;
  background: rgba(0, 0, 0, 0.35) !important;
  border: 1px solid rgba(255, 255, 255, 0.08) !important;
  border-radius: 12px !important;
  padding: 18px 24px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
  gap: 16px !important;
  transition: transform 150ms ease, box-shadow 150ms ease !important;
  backdrop-filter: blur(8px) !important;
  -webkit-backdrop-filter: blur(8px) !important;
  box-sizing: border-box !important;
  cursor: default !important;
}

.{{ bit_wrapper_class }} .bit-event:hover {
  transform: translateY(-2px) !important;
  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.4) !important;
}

/* --- Inner layout: meta (date + details) left, buttons right --- */
.{{ bit_wrapper_class }} .bit-event__meta,
.{{ bit_wrapper_class }} .bit-event-meta {
  display: flex !important;
  align-items: center !important;
  gap: 20px !important;
  flex: 1 !important;
  min-width: 0 !important;
}

/* --- Date block --- */
.{{ bit_wrapper_class }} .bit-date,
.{{ bit_wrapper_class }} .bit-event-date,
.{{ bit_wrapper_class }} .bit-event__dates,
.{{ bit_wrapper_class }} .bit-event__date {
  display: flex !important;
  flex-direction: column !important;
  align-items: flex-start !important;
  min-width: 72px !important;
  flex-shrink: 0 !important;
  color: #ff6a00 !important;
  font-weight: 700 !important;
  text-transform: uppercase !important;
  letter-spacing: 0.04em !important;
  line-height: 1.2 !important;
  font-size: 0.92em !important;
}

.{{ bit_wrapper_class }} .bit-date *,
.{{ bit_wrapper_class }} .bit-event-date *,
.{{ bit_wrapper_class }} .bit-event__dates *,
.{{ bit_wrapper_class }} .bit-event__date * {
  color: #ff6a00 !important;
  font-weight: 700 !important;
}

/* --- Details block (venue + city) --- */
.{{ bit_wrapper_class }} .bit-details,
.{{ bit_wrapper_class }} .bit-event__details,
.{{ bit_wrapper_class }} .bit-event-details {
  display: flex !important;
  flex-direction: column !important;
  gap: 2px !important;
  flex: 1 !important;
  min-width: 0 !important;
}

.{{ bit_wrapper_class }} .bit-venue,
.{{ bit_wrapper_class }} .bit-event__venue,
.{{ bit_wrapper_class }} [class*="venue-title"],
.{{ bit_wrapper_class }} [class*="venue-name"] {
  color: #ffffff !important;
  font-size: 1.05em !important;
  font-weight: 600 !important;
  letter-spacing: 0.01em !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.{{ bit_wrapper_class }} .bit-location,
.{{ bit_wrapper_class }} .bit-event__location,
.{{ bit_wrapper_class }} [class*="location-info"] {
  color: rgba(255, 255, 255, 0.5) !important;
  font-size: 0.82em !important;
  letter-spacing: 0.02em !important;
}

/* --- Buttons container --- */
.{{ bit_wrapper_class }} .bit-event__buttons,
.{{ bit_wrapper_class }} .bit-event-buttons,
.{{ bit_wrapper_class }} .bit-actions {
  display: flex !important;
  align-items: center !important;
  gap: 8px !important;
  flex-shrink: 0 !important;
}

/* --- Ticket / CTA button --- */
.{{ bit_wrapper_class }} .bit-cta-button,
.{{ bit_wrapper_class }} a.bit-cta-button,
.{{ bit_wrapper_class }} .bit-cta,
.{{ bit_wrapper_class }} a.bit-ticket-button,
.{{ bit_wrapper_class }} .bit-event__ticket-btn,
.{{ bit_wrapper_class }} [class*="ticket-btn"],
.{{ bit_wrapper_class }} [class*="cta-button"] {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  background: #ff6a00 !important;
  color: #0d0d0d !important;
  border-radius: 999px !important;
  padding: 8px 20px !important;
  font-size: 0.78em !important;
  font-weight: 700 !important;
  letter-spacing: 0.06em !important;
  text-transform: uppercase !important;
  text-decoration: none !important;
  white-space: nowrap !important;
  box-shadow: 0 0 0 1px rgba(255, 106, 0, 0.35), 0 8px 26px rgba(255, 106, 0, 0.18) !important;
  transition: filter 140ms ease, transform 140ms ease !important;
  border: none !important;
  cursor: pointer !important;
  line-height: 1 !important;
}

.{{ bit_wrapper_class }} .bit-cta-button:hover,
.{{ bit_wrapper_class }} a.bit-cta-button:hover,
.{{ bit_wrapper_class }} .bit-event__ticket-btn:hover,
.{{ bit_wrapper_class }} [class*="ticket-btn"]:hover,
.{{ bit_wrapper_class }} [class*="cta-button"]:hover {
  filter: brightness(1.12) !important;
  transform: translateY(-1px) !important;
  text-decoration: none !important;
}

/* --- Show-more button --- */
.{{ bit_wrapper_class }} .gk-bit-more-wrap {
  margin-top: 20px;
  text-align: center;
}

.{{ bit_wrapper_class }} .gk-bit-more-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  color: #ff6a00;
  border: 1px solid rgba(255, 106, 0, 0.5);
  border-radius: 999px;
  padding: 10px 28px;
  font-size: 0.78em;
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  cursor: pointer;
  transition: background 150ms ease, border-color 150ms ease, color 150ms ease;
  font-family: inherit;
}

.{{ bit_wrapper_class }} .gk-bit-more-btn:hover {
  background: rgba(255, 106, 0, 0.12);
  border-color: #ff6a00;
}

.{{ bit_wrapper_class }} .gk-bit-more-btn[hidden],
.{{ bit_wrapper_class }} .gk-bit-more-btn[style*="display: none"],
.{{ bit_wrapper_class }} .gk-bit-more-btn[style*="display:none"] {
  display: none !important;
}

/* --- Fallback message --- */
.{{ bit_wrapper_class }} .gk-bit-fallback {
  display: none;
  color: rgba(255, 255, 255, 0.4);
  font-size: 0.9em;
  padding: 24px 0;
  text-align: center;
}

/* --- Mobile responsive --- */
@media screen and (max-width: 640px) {
  .{{ bit_wrapper_class }} .bit-event,
  .{{ bit_wrapper_class }} li.bit-event {
    flex-direction: column !important;
    align-items: flex-start !important;
    padding: 16px 18px !important;
    gap: 12px !important;
  }

  .{{ bit_wrapper_class }} .bit-event__meta,
  .{{ bit_wrapper_class }} .bit-event-meta {
    flex-direction: column !important;
    align-items: flex-start !important;
    gap: 6px !important;
    width: 100% !important;
  }

  .{{ bit_wrapper_class }} .bit-event__buttons,
  .{{ bit_wrapper_class }} .bit-event-buttons,
  .{{ bit_wrapper_class }} .bit-actions {
    width: 100% !important;
  }

  .{{ bit_wrapper_class }} .bit-cta-button,
  .{{ bit_wrapper_class }} a.bit-cta-button,
  .{{ bit_wrapper_class }} [class*="ticket-btn"],
  .{{ bit_wrapper_class }} [class*="cta-button"] {
    width: 100% !important;
    justify-content: center !important;
  }
}
</style>

<div id="{{ _uid }}" class="{{ bit_wrapper_class }}__embed">
  <a
    class="bit-widget-initializer"
    data-artist-name="{{ bit_artist | escape }}"
    data-display-limit="50"
    data-background-color="transparent"
    data-text-color="#ffffff"
    data-link-color="#ff6a00"
    data-link-text-color="#0d0d0d"
    data-separator-color="rgba(255,255,255,0.08)"
    data-font="inherit"
    data-auto-style="false"
    data-display-past-dates="false"
    data-display-local-dates="false"
    data-locale="en"
    data-layout="standard"
    data-display-lineup="false"
    data-display-start-time="false"
    data-social-share-icon="false"
    data-widget-width="100%"
  ></a>

  <div class="gk-bit-more-wrap">
    <button type="button" class="gk-bit-more-btn" hidden>
      {{ bit_more_label | escape }}
    </button>
  </div>

  <div class="gk-bit-fallback">
    Check back soon for upcoming dates.
  </div>
</div>

<script charset="utf-8" src="https://widget.bandsintown.com/main.min.js"></script>

<script>
(function () {
  var uid       = {{ _uid | json }};
  var wrap      = document.getElementById(uid);
  if (!wrap) return;

  var maxInit   = {{ bit_initial_visible | plus: 0 }};
  var step      = {{ bit_reveal_step | plus: 0 }};
  var moreBtn   = wrap.querySelector('.gk-bit-more-btn');
  var fallback  = wrap.querySelector('.gk-bit-fallback');
  var applied   = false;

  function getEvents() {
    return wrap.querySelectorAll('.bit-event');
  }

  function applyVisibility() {
    var events = getEvents();
    if (!events.length) return;
    applied = true;

    for (var i = 0; i < events.length; i++) {
      events[i].style.display = i < maxInit ? '' : 'none';
    }

    updateMoreBtn();
  }

  function updateMoreBtn() {
    var events = getEvents();
    var hidden = 0;
    for (var i = 0; i < events.length; i++) {
      if (events[i].style.display === 'none') hidden++;
    }
    if (moreBtn) {
      if (hidden > 0) {
        moreBtn.removeAttribute('hidden');
        moreBtn.style.display = '';
      } else {
        moreBtn.setAttribute('hidden', '');
        moreBtn.style.display = 'none';
      }
    }
  }

  if (moreBtn) {
    moreBtn.addEventListener('click', function () {
      var events = getEvents();
      var revealed = 0;
      for (var i = 0; i < events.length && revealed < step; i++) {
        if (events[i].style.display === 'none') {
          events[i].style.display = '';
          revealed++;
        }
      }
      updateMoreBtn();
    });
  }

  /* Watch for BIT widget rendering events into the DOM */
  var observer = new MutationObserver(function () {
    if (!applied && getEvents().length > 0) {
      observer.disconnect();
      applyVisibility();
    }
  });
  observer.observe(wrap, { childList: true, subtree: true });

  /* Check immediately in case the widget already rendered */
  if (getEvents().length > 0) {
    observer.disconnect();
    applyVisibility();
  }

  /* Fallback: after 8 seconds, if no events, show message */
  setTimeout(function () {
    observer.disconnect();
    if (!applied) {
      if (getEvents().length > 0) {
        applyVisibility();
      } else if (fallback) {
        fallback.style.display = '';
      }
    }
  }, 8000);
})();
</script>
