{%- comment -%}
  GK About Gallery Section
  - Mimics old site: big heading + main image + credit + 4 thumbnails
  - Main image + thumbnails open fullscreen modal (lightbox)
  - Premium motion: depth slide + stagger
  - Self-contained CSS + JS, scoped to section.id
  NOTE: We treat "." as “empty” for optional text fields (Shopify schema won’t allow blank defaults).
{%- endcomment -%}

{%- liquid
  assign eyebrow_val = section.settings.eyebrow | strip
  assign credit_val = section.settings.main_credit | strip
  assign body_val = section.settings.body
-%}

<section
  id="GK-AboutGallery-{{ section.id }}"
  class="gk-aboutGallery"
  data-gk-anim="{{ section.settings.enable_animation | json }}"
>
  <div class="page-width gk-aboutGallery__inner">

    {%- if eyebrow_val != blank and eyebrow_val != '.' -%}
      <div class="gk-aboutGallery__eyebrow">{{ section.settings.eyebrow }}</div>
    {%- endif -%}

    {%- if section.settings.heading != blank -%}
      <h2 class="gk-aboutGallery__heading">{{ section.settings.heading }}</h2>
    {%- endif -%}

    {%- if section.settings.main_image != blank -%}
      <figure class="gk-aboutGallery__heroFigure">
        <button
          type="button"
          class="gk-aboutGallery__heroBtn"
          data-gk-open
          data-gk-src="{{ section.settings.main_image | image_url: width: 2800 }}"
          data-gk-alt="{{ section.settings.main_image.alt | escape }}"
          aria-label="Open image"
        >
          <div class="gk-aboutGallery__heroMedia">
            {%- liquid
              assign img = section.settings.main_image
              assign img_h = img.width | divided_by: img.aspect_ratio
            -%}
            {{
              img
              | image_url: width: 2400
              | image_tag:
                width: img.width,
                height: img_h,
                loading: 'lazy',
                widths: '700, 1000, 1400, 1800, 2200, 2400',
                sizes: '(min-width: 990px) 1100px, (min-width: 750px) 92vw, 94vw',
                class: 'gk-aboutGallery__heroImg'
            }}
          </div>
        </button>

        {%- if credit_val != blank and credit_val != '.' -%}
          <figcaption class="gk-aboutGallery__credit">
            {{ section.settings.main_credit }}
          </figcaption>
        {%- endif -%}
      </figure>
    {%- endif -%}

    {%- comment -%} Thumbnails should be directly under the hero (OLD SITE ORDER) {%- endcomment -%}
    {%- liquid
      assign has_thumbs = false
      if section.settings.thumb_1 != blank or section.settings.thumb_2 != blank or section.settings.thumb_3 != blank or section.settings.thumb_4 != blank
        assign has_thumbs = true
      endif
    -%}

    {%- if has_thumbs -%}
      <div class="gk-aboutGallery__thumbGrid" role="list" aria-label="Gallery thumbnails">
        {%- for i in (1..4) -%}
          {%- liquid
            assign img_key = 'thumb_' | append: i
            assign alt_key = 'thumb_alt_' | append: i

            assign t = section.settings[img_key]
            assign alt_override = section.settings[alt_key] | strip

            if t != blank
              assign full = t | image_url: width: 2800
              assign alt = t.alt
              if alt_override != blank and alt_override != '.'
                assign alt = alt_override
              endif
              assign t_h = t.width | divided_by: t.aspect_ratio
            endif
          -%}

          {%- if t != blank -%}
            <button
              type="button"
              class="gk-aboutGallery__thumb"
              role="listitem"
              data-gk-open
              data-gk-src="{{ full }}"
              data-gk-alt="{{ alt | escape }}"
              aria-label="Open image"
            >
              {{
                t
                | image_url: width: 900
                | image_tag:
                  width: t.width,
                  height: t_h,
                  loading: 'lazy',
                  widths: '300, 450, 600, 750, 900',
                  sizes: '(min-width: 990px) 260px, (min-width: 750px) 22vw, 42vw',
                  class: 'gk-aboutGallery__thumbImg'
              }}
            </button>
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- endif -%}

    {%- comment -%} Body copy comes AFTER thumbnails (OLD SITE ORDER) {%- endcomment -%}
    {%- if body_val != blank -%}
      <div class="gk-aboutGallery__rte rte">
        {{ section.settings.body }}
      </div>
    {%- endif -%}

  </div>

  {%- comment -%} Modal (scoped) {%- endcomment -%}
  <div class="gk-aboutGallery__modal" hidden aria-hidden="true">
    <div class="gk-aboutGallery__backdrop" data-gk-close></div>

    <div
      class="gk-aboutGallery__dialog"
      role="dialog"
      aria-modal="true"
      aria-label="Image preview"
      tabindex="-1"
    >
      <button type="button" class="gk-aboutGallery__close" data-gk-close aria-label="Close">
        ×
      </button>

      <div class="gk-aboutGallery__modalMedia">
        <img class="gk-aboutGallery__modalImg" alt="" loading="eager" />
      </div>
    </div>
  </div>

  <style>
    /* (UNCHANGED) — keep your existing CSS exactly as-is */
  </style>

  <script>
    /* (UNCHANGED) — keep your existing JS exactly as-is */
  </script>
</section>

{% schema %}
{
  "name": "GK About Gallery",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_animation",
      "default": true,
      "label": "Enable fly-in animation"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow (optional)",
      "default": "."
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "About the Koch Marshall Trio"
    },
    {
      "type": "image_picker",
      "id": "main_image",
      "label": "Main image"
    },
    {
      "type": "text",
      "id": "main_credit",
      "label": "Main photo credit (optional)",
      "default": "above photo credit: ©2025CJFoeckler"
    },
    {
      "type": "header",
      "content": "Thumbnail images (click to expand)"
    },
    {
      "type": "image_picker",
      "id": "thumb_1",
      "label": "Thumbnail 1"
    },
    {
      "type": "text",
      "id": "thumb_alt_1",
      "label": "Alt text override 1 (optional)",
      "default": "."
    },
    {
      "type": "image_picker",
      "id": "thumb_2",
      "label": "Thumbnail 2"
    },
    {
      "type": "text",
      "id": "thumb_alt_2",
      "label": "Alt text override 2 (optional)",
      "default": "."
    },
    {
      "type": "image_picker",
      "id": "thumb_3",
      "label": "Thumbnail 3"
    },
    {
      "type": "text",
      "id": "thumb_alt_3",
      "label": "Alt text override 3 (optional)",
      "default": "."
    },
    {
      "type": "image_picker",
      "id": "thumb_4",
      "label": "Thumbnail 4"
    },
    {
      "type": "text",
      "id": "thumb_alt_4",
      "label": "Alt text override 4 (optional)",
      "default": "."
    },
    {
      "type": "richtext",
      "id": "body",
      "label": "Body text",
      "default": "<p>Add your updated copy here. This is editable in the theme editor.</p>"
    },
    {
      "type": "color",
      "id": "accent",
      "label": "Accent color",
      "default": "#E8690A"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 140,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 44
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 140,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 52
    }
  ],
  "presets": [
    {
      "name": "GK About Gallery"
    }
  ]
}
{% endschema %}