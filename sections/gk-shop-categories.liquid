{% comment %}
  GK Shop Categories (Shop Landing Section)
  - Dark glassy cards
  - Subtle orange glow hover
  - Bold hero like tour dates
  - Uses collection pickers (Theme Editor)
  - Hides tiles when no collection assigned
  - Scoped CSS only (no global conflicts)

  OPTIONAL AUTO-SCROLL:
  - If the collection URL has #products at the end, we auto-scroll to the product grid.
  - Example: /collections/cds#products
{% endcomment %}

<section class="gk-shopcats" data-gk-shopcats>
  <div class="gk-shopcats__wrap">
    <header class="gk-shopcats__hero">
      {% if section.settings.kicker != blank %}
        <div class="gk-shopcats__kicker">{{ section.settings.kicker | escape }}</div>
      {% endif %}

      {% if section.settings.heading != blank %}
        <h1 class="gk-shopcats__heading">{{ section.settings.heading | escape }}</h1>
      {% endif %}

      {% if section.settings.subtext != blank %}
        <div class="gk-shopcats__subtext">{{ section.settings.subtext }}</div>
      {% endif %}
    </header>

    <div class="gk-shopcats__grid" role="list">
      {% assign count = 0 %}

      {% for block in section.blocks %}
        {% if block.type == "category" %}
          {% assign col = block.settings.collection %}
          {% if col != blank %}
            {% assign count = count | plus: 1 %}
            <a
              class="gk-shopcats__card"
              href="{{ col.url }}#products"
              role="listitem"
              aria-label="Shop {{ block.settings.title | escape }}"
              {{ block.shopify_attributes }}
            >
              <div class="gk-shopcats__cardTop">
                <div class="gk-shopcats__titleRow">
                  <div class="gk-shopcats__title">{{ block.settings.title | escape }}</div>
                  <span class="gk-shopcats__arrow" aria-hidden="true">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none">
                      <path d="M5 12h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                      <path d="M13 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </span>
                </div>

                {% if block.settings.desc != blank %}
                  <div class="gk-shopcats__desc">{{ block.settings.desc | escape }}</div>
                {% endif %}
              </div>

              <div class="gk-shopcats__cta">
                <span class="gk-shopcats__ctaText">{{ block.settings.cta | default: "Explore" | escape }}</span>
                <span class="gk-shopcats__ctaPip" aria-hidden="true"></span>
              </div>
            </a>
          {% endif %}
        {% endif %}
      {% endfor %}

      {% if count == 0 %}
        <div class="gk-shopcats__empty">
          <div class="gk-shopcats__emptyTitle">No categories assigned yet.</div>
          <div class="gk-shopcats__emptyText">
            Open Theme Editor → Shop page → GK Shop Categories, then select collections for each category tile.
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  <style>
    /* =========================
       GK SHOP CATEGORIES (SCOPED)
       ========================= */
    .gk-shopcats{
      position: relative;
      padding: clamp(44px, 6vw, 84px) 0;
      background: transparent;
      color: inherit;
    }

    .gk-shopcats__wrap{
      width: min(1200px, calc(100% - 48px));
      margin: 0 auto;
    }

    .gk-shopcats__hero{
      margin-bottom: clamp(22px, 3vw, 36px);
    }

    .gk-shopcats__kicker{
      letter-spacing: .14em;
      text-transform: uppercase;
      font-size: 12px;
      opacity: .8;
      margin-bottom: 10px;
    }

    .gk-shopcats__heading{
      margin: 0;
      line-height: 1;
      font-weight: 800;
      text-transform: uppercase;
      font-size: clamp(44px, 6.2vw, 86px);
    }

    .gk-shopcats__subtext{
      margin-top: 12px;
      max-width: 62ch;
      opacity: .9;
      font-size: 16px;
      line-height: 1.5;
    }

    .gk-shopcats__grid{
      display: grid;
      gap: 18px;
      grid-template-columns: repeat(12, 1fr);
      align-items: stretch;
    }

    /* Card layout: 4 columns on wide screens */
    .gk-shopcats__card{
      grid-column: span 3;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      border-radius: 18px;
      padding: 18px 18px 16px 18px;
      text-decoration: none;
      color: inherit;

      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow:
        0 10px 30px rgba(0,0,0,.35),
        inset 0 1px 0 rgba(255,255,255,.05);

      transition: transform 160ms ease, border-color 160ms ease, box-shadow 160ms ease;
      will-change: transform;
      overflow: hidden;
    }

    .gk-shopcats__card:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(800px 220px at 15% 10%, rgba(255,153,0,.18), transparent 55%),
        radial-gradient(700px 240px at 85% 0%, rgba(255,153,0,.10), transparent 60%);
      opacity: .35;
      pointer-events:none;
    }

    .gk-shopcats__card:after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.05), rgba(0,0,0,.25));
      opacity: .6;
      pointer-events:none;
    }

    .gk-shopcats__cardTop,
    .gk-shopcats__cta{
      position: relative;
      z-index: 1;
    }

    .gk-shopcats__titleRow{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
    }

    .gk-shopcats__title{
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: .02em;
      font-size: 18px;
    }

    .gk-shopcats__arrow{
      opacity: .9;
      transform: translateX(0);
      transition: transform 160ms ease, opacity 160ms ease;
    }

    .gk-shopcats__desc{
      margin-top: 8px;
      opacity: .85;
      font-size: 13px;
      line-height: 1.45;
    }

    .gk-shopcats__cta{
      margin-top: 16px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,.10);
      opacity: .95;
    }

    .gk-shopcats__ctaText{
      font-size: 13px;
      letter-spacing: .08em;
      text-transform: uppercase;
      font-weight: 700;
    }

    .gk-shopcats__ctaPip{
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(255,153,0,.95);
      box-shadow: 0 0 18px rgba(255,153,0,.55);
      flex: 0 0 auto;
      opacity: .9;
    }

    .gk-shopcats__card:hover{
      transform: translateY(-1px);
      border-color: rgba(255,153,0,.35);
      box-shadow:
        0 12px 34px rgba(0,0,0,.45),
        0 0 24px rgba(255,153,0,.10),
        inset 0 1px 0 rgba(255,255,255,.06);
    }

    .gk-shopcats__card:hover .gk-shopcats__arrow{
      transform: translateX(2px);
      opacity: 1;
    }

    .gk-shopcats__card:focus-visible{
      outline: none;
      border-color: rgba(255,153,0,.55);
      box-shadow:
        0 0 0 3px rgba(255,153,0,.20),
        0 12px 34px rgba(0,0,0,.45);
    }

    @media (max-width: 980px){
      .gk-shopcats__card{ grid-column: span 6; }
    }
    @media (max-width: 520px){
      .gk-shopcats__wrap{ width: calc(100% - 28px); }
      .gk-shopcats__card{ grid-column: span 12; }
      .gk-shopcats__heading{ font-size: clamp(36px, 10vw, 54px); }
    }

    .gk-shopcats__empty{
      grid-column: 1 / -1;
      border-radius: 18px;
      padding: 18px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
    }
    .gk-shopcats__emptyTitle{
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: .04em;
      margin-bottom: 6px;
    }
    .gk-shopcats__emptyText{
      opacity: .85;
      font-size: 14px;
      line-height: 1.45;
    }
  </style>

  <script>
  (function() {
    function scrollToProductsIfNeeded() {
      if (window.location.hash !== "#products") return;

      var el =
        document.getElementById("ProductGridContainer") ||
        document.querySelector("#product-grid") ||
        document.querySelector(".product-grid-container") ||
        document.querySelector(".collection .product-grid") ||
        document.querySelector(".collection");

      if (!el) return;

      setTimeout(function() {
        el.scrollIntoView({ behavior: "smooth", block: "start" });
      }, 150);
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", scrollToProductsIfNeeded);
    } else {
      scrollToProductsIfNeeded();
    }
  })();
  </script>
</section>

{% schema %}
{
  "name": "GK Shop Categories",
  "settings": [
    {
      "type": "text",
      "id": "kicker",
      "label": "Kicker",
      "default": "Browse the goods"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "The Gristle Shop"
    },
    {
      "type": "richtext",
      "id": "subtext",
      "label": "Subtext",
      "default": "<p>Records. Gear. Tools of tone. Wear the sound.</p>"
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Category tile",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "CDs"
        },
        {
          "type": "text",
          "id": "desc",
          "label": "Description",
          "default": "Studio albums and live records."
        },
        {
          "type": "text",
          "id": "cta",
          "label": "CTA text",
          "default": "Explore"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "GK Shop Categories",
      "blocks": [
        { "type": "category", "settings": { "title": "NEW!", "desc": "Latest drops and fresh arrivals.", "cta": "Explore" } },
        { "type": "category", "settings": { "title": "CDs", "desc": "Studio albums and live records.", "cta": "Explore" } },
        { "type": "category", "settings": { "title": "Vinyl", "desc": "Wax. Analog. Real.", "cta": "Explore" } },
        { "type": "category", "settings": { "title": "Merch", "desc": "Wear the gristle.", "cta": "Explore" } },
        { "type": "category", "settings": { "title": "Gear", "desc": "Pedals, pickups, tone tools.", "cta": "Explore" } },
        { "type": "category", "settings": { "title": "Instructional Books", "desc": "Learn from the Gristleman.", "cta": "Explore" } },
        { "type": "category", "settings": { "title": "DVDs", "desc": "Classic guitar instruction.", "cta": "Explore" } }
      ]
    }
  ]
}
{% endschema %}