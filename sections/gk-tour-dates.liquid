{%- style -%}
  .gk-tour-dates {
    background-color: {{ section.settings.bg_color }};
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
  }

  .gk-tour-dates__inner {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 0 24px;
  }

  .gk-tour-dates__eyebrow {
    font-family: 'DM Mono', monospace;
    text-transform: uppercase;
    letter-spacing: 3px;
    font-size: 0.75rem;
    color: #E8690A;
    margin-bottom: 12px;
    display: block;
    text-align: {{ section.settings.text_alignment }};
  }

  .gk-tour-dates__heading {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(2rem, 5vw, 3.5rem);
    color: #E8E8E8;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin: 0 0 8px 0;
    text-align: {{ section.settings.text_alignment }};
  }

  .gk-tour-dates__subtext {
    font-family: 'DM Sans', sans-serif;
    color: #777777;
    font-size: 1rem;
    margin-bottom: 32px;
    text-align: {{ section.settings.text_alignment }};
  }

  .gk-tour-dates__embed {
    width: 100%;
    min-height: 400px;
  }

  .gk-tour-dates__embed iframe {
    width: 100%;
    border: none;
  }

  /* Override Bandsintown widget dark styles */
  .gk-tour-dates .bit-widget {
    background-color: transparent !important;
  }

  .gk-tour-dates__fallback {
    text-align: center;
    padding: 60px 24px;
    border: 1px solid #272727;
    background-color: #141414;
  }

  .gk-tour-dates__fallback-text {
    color: #777777;
    font-family: 'DM Sans', sans-serif;
    margin-bottom: 24px;
  }

  .gk-tour-dates__btn {
    display: inline-block;
    font-family: 'DM Sans', sans-serif;
    text-transform: uppercase;
    letter-spacing: 2px;
    font-size: 0.85rem;
    font-weight: 500;
    padding: 14px 36px;
    border-radius: 0;
    text-decoration: none;
    background-color: #E8690A;
    color: #FFFFFF;
    border: 2px solid #E8690A;
    transition: all 0.3s ease;
  }

  .gk-tour-dates__btn:hover {
    background-color: transparent;
    color: #E8690A;
  }
{%- endstyle -%}

<section class="gk-tour-dates" id="section-{{ section.id }}">
  <div class="gk-tour-dates__inner">
    {%- for block in section.blocks -%}
      {%- case block.type -%}
        {%- when 'eyebrow' -%}
          {%- if block.settings.text != blank -%}
            <span class="gk-tour-dates__eyebrow" {{ block.shopify_attributes }}>{{ block.settings.text }}</span>
          {%- endif -%}

        {%- when 'heading' -%}
          {%- if block.settings.heading != blank -%}
            <h2 class="gk-tour-dates__heading" {{ block.shopify_attributes }}>{{ block.settings.heading }}</h2>
          {%- endif -%}

        {%- when 'subtext' -%}
          {%- if block.settings.text != blank -%}
            <p class="gk-tour-dates__subtext" {{ block.shopify_attributes }}>{{ block.settings.text }}</p>
          {%- endif -%}

        {%- when 'bandsintown_embed' -%}
          <div class="gk-tour-dates__embed" {{ block.shopify_attributes }}>
            {%- if block.settings.artist_name != blank -%}
              <a class="bit-widget-initializer"
                data-artist-name="{{ block.settings.artist_name }}"
                data-display-local-dates="false"
                data-display-past-dates="{{ block.settings.show_past_dates }}"
                data-auto-style="false"
                data-text-color="#E8E8E8"
                data-link-color="#E8690A"
                data-background-color="transparent"
                data-display-limit="{{ block.settings.display_limit }}"
                data-display-start-time="false"
                data-link-text-color="#FFFFFF"
                data-display-lineup="false"
                data-display-play-my-city="{{ block.settings.show_play_my_city }}"
                data-separator-color="#272727"
              ></a>
            {%- else -%}
              <div class="gk-tour-dates__fallback">
                <p class="gk-tour-dates__fallback-text">Configure the Bandsintown artist name in the theme editor to display tour dates.</p>
              </div>
            {%- endif -%}
          </div>

        {%- when 'custom_html' -%}
          {%- if block.settings.html != blank -%}
            <div class="gk-tour-dates__embed" {{ block.shopify_attributes }}>
              {{ block.settings.html }}
            </div>
          {%- endif -%}

        {%- when 'button' -%}
          {%- if block.settings.label != blank -%}
            <div style="text-align: {{ section.settings.text_alignment }}; margin-top: 24px;">
              <a href="{{ block.settings.link }}" class="gk-tour-dates__btn" {{ block.shopify_attributes }}>
                {{ block.settings.label }}
              </a>
            </div>
          {%- endif -%}
      {%- endcase -%}
    {%- endfor -%}
  </div>
</section>

{%- if section.blocks.size > 0 -%}
  {%- for block in section.blocks -%}
    {%- if block.type == 'bandsintown_embed' and block.settings.artist_name != blank -%}
      <script charset="utf-8" src="https://widgetv3.bandsintown.com/main.min.js"></script>
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

{% schema %}
{
  "name": "GK Tour Dates",
  "tag": "section",
  "class": "gk-tour-dates-section",
  "settings": [
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#0D0D0D"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text Alignment",
      "default": "center",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ]
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding Top",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 60,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding Bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 60,
      "unit": "px"
    }
  ],
  "blocks": [
    {
      "type": "eyebrow",
      "name": "Eyebrow Text",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Eyebrow Text",
          "default": "On the Road"
        }
      ]
    },
    {
      "type": "heading",
      "name": "Heading",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "TOUR DATES"
        }
      ]
    },
    {
      "type": "subtext",
      "name": "Subtext",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Subtext",
          "default": "Catch the Gristle live near you."
        }
      ]
    },
    {
      "type": "bandsintown_embed",
      "name": "Bandsintown Widget",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "artist_name",
          "label": "Artist Name",
          "default": "Greg Koch",
          "info": "Exact artist name as it appears on Bandsintown"
        },
        {
          "type": "range",
          "id": "display_limit",
          "label": "Number of Dates to Show",
          "min": 5,
          "max": 30,
          "step": 1,
          "default": 15
        },
        {
          "type": "checkbox",
          "id": "show_past_dates",
          "label": "Show Past Dates",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "show_play_my_city",
          "label": "Show Play My City",
          "default": true
        }
      ]
    },
    {
      "type": "custom_html",
      "name": "Custom HTML",
      "limit": 1,
      "settings": [
        {
          "type": "html",
          "id": "html",
          "label": "Custom Embed Code",
          "info": "Paste any embed code (Bandsintown, Songkick, etc.)"
        }
      ]
    },
    {
      "type": "button",
      "name": "Button",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Button Label",
          "default": "SEE ALL DATES"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Button Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "GK Tour Dates",
      "blocks": [
        { "type": "eyebrow" },
        { "type": "heading" },
        { "type": "subtext" },
        { "type": "bandsintown_embed" }
      ]
    }
  ]
}
{% endschema %}
