{%- comment -%}
  GK Spotify Embed
  - Premium “dates-style” glass card frame
  - Orange accent glow + subtle 3D lift
  - NOTE: Spotify iframe UI itself cannot be styled (cross-domain)
{%- endcomment -%}

{%- liquid
  assign eyebrow_val = section.settings.eyebrow | strip
  assign heading_val = section.settings.heading | strip
  assign subheading_val = section.settings.subheading | strip
  assign embed_src = section.settings.embed_src | strip
  assign open_url = section.settings.open_url | strip
-%}

<section
  id="GK-SpotifyEmbed-{{ section.id }}"
  class="gk-spotifyEmbed"
  data-gk-anim="{{ section.settings.enable_animation | json }}"
>
  <div class="page-width gk-spotifyEmbed__inner">

    {%- if eyebrow_val != blank and eyebrow_val != '.' -%}
      <div class="gk-spotifyEmbed__eyebrow">{{ eyebrow_val }}</div>
    {%- endif -%}

    {%- if heading_val != blank -%}
      <div class="gk-spotifyEmbed__headRow">
        <h2 class="gk-spotifyEmbed__heading">{{ heading_val }}</h2>

        {%- if section.settings.show_open_button and open_url != blank -%}
          <a class="gk-spotifyEmbed__btn" href="{{ open_url }}" target="_blank" rel="noopener">
            Open on Spotify
          </a>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- if subheading_val != blank and subheading_val != '.' -%}
      <div class="gk-spotifyEmbed__sub">{{ subheading_val }}</div>
    {%- endif -%}

    {%- if embed_src != blank -%}
      <div class="gk-spotifyEmbed__frame" aria-label="Spotify player">
        <div class="gk-spotifyEmbed__frameInner">
          <iframe
            class="gk-spotifyEmbed__iframe"
            style="border-radius: 12px;"
            src="{{ embed_src }}"
            width="100%"
            height="{{ section.settings.height }}"
            frameborder="0"
            allowfullscreen=""
            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
            loading="lazy"
            title="Spotify embed"
          ></iframe>
        </div>
      </div>
    {%- endif -%}

  </div>

  <style>
    /* ============================
      GK Spotify Embed (scoped)
      ============================ */
    #GK-SpotifyEmbed-{{ section.id }}.gk-spotifyEmbed {
      --accent: {{ section.settings.accent | default: '#E8690A' }};
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.66);
      --line: rgba(255,255,255,0.10);
      --card: rgba(255,255,255,0.06);

      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }

    #GK-SpotifyEmbed-{{ section.id }} .gk-spotifyEmbed__inner{
      max-width: 1100px;
      margin: 0 auto;
    }

    #GK-SpotifyEmbed-{{ section.id }} .gk-spotifyEmbed__eyebrow{
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 10px;
    }

    #GK-SpotifyEmbed-{{ section.id }} .gk-spotifyEmbed__headRow{
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 14px;
      margin-bottom: 10px;
    }

    #GK-SpotifyEmbed-{{ section.id }} .gk-spotifyEmbed__heading{
      margin: 0;
      font-weight: 800;
      line-height: 1.05;
      letter-spacing: 0.01em;
      font-size: clamp(34px, 4.5vw, 56px);
      color: var(--text);
    }

    #GK-SpotifyEmbed-{{ section.id }} .gk-spotifyEmbed__sub{
      color: var(--muted);
      font-size: 16px;
      margin-bottom: 18px;
    }

    /* Button matches “dates” vibes */
    #GK-SpotifyEmbed-{{ section.id }} .gk-spotifyEmbed__btn{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 16px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.25);
      color: rgba(255,255,255,0.88);
      text-decoration: none;
      font-weight: 700;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-size: 12px;
      transition: transform 160ms ease, border-color 160ms ease, box-shadow 160ms ease, background 160ms ease;
      white-space: nowrap;
    }

    @media (hover:hover){
      #GK-SpotifyEmbed-{{ section.id }} .gk-spotifyEmbed__btn:hover{
        transform: translateY(-1px);
        border-color: rgba(232,105,10,0.35);
        background: rgba(0,0,0,0.35);
        box-shadow: 0 16px 44px rgba(0,0,0,0.35);
      }
    }

    /* The “dates-style” frame */
    #GK-SpotifyEmbed-{{ section.id }} .gk-spotifyEmbed__frame{
      position: relative;
      border-radius: 22px;
      padding: 14px;
      background:
        radial-gradient(800px 220px at 20% 10%, rgba(232,105,10,0.20), transparent 60%),
        radial-gradient(800px 220px at 80% 0%, rgba(232,105,10,0.12), transparent 55%),
        rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow:
        0 24px 80px rgba(0,0,0,0.55),
        inset 0 1px 0 rgba(255,255,255,0.06);
      transform: translateZ(0);
    }

    /* Extra “bezel” inside, like a premium device frame */
    #GK-SpotifyEmbed-{{ section.id }} .gk-spotifyEmbed__frameInner{
      border-radius: 16px;
      overflow: hidden;
      background:
        linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow:
        inset 0 0 0 1px rgba(0,0,0,0.35),
        0 12px 46px rgba(0,0,0,0.40);
    }

    #GK-SpotifyEmbed-{{ section.id }} .gk-spotifyEmbed__iframe{
      display: block;
      width: 100%;
      border: 0;
      /* This is just for crisp rendering */
      transform: translateZ(0);
    }

    /* Subtle 3D lift/glow on hover */
    @media (hover:hover){
      #GK-SpotifyEmbed-{{ section.id }} .gk-spotifyEmbed__frame{
        transition: transform 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
      }
      #GK-SpotifyEmbed-{{ section.id }} .gk-spotifyEmbed__frame:hover{
        transform: translateY(-1px);
        border-color: rgba(232,105,10,0.26);
        box-shadow:
          0 30px 100px rgba(0,0,0,0.60),
          0 0 0 1px rgba(232,105,10,0.10),
          inset 0 1px 0 rgba(255,255,255,0.06);
      }
    }

    /* ============================
      Motion (optional)
      ============================ */
    #GK-SpotifyEmbed-{{ section.id }}[data-gk-anim="true"] .gk-spotifyEmbed__eyebrow,
    #GK-SpotifyEmbed-{{ section.id }}[data-gk-anim="true"] .gk-spotifyEmbed__headRow,
    #GK-SpotifyEmbed-{{ section.id }}[data-gk-anim="true"] .gk-spotifyEmbed__sub,
    #GK-SpotifyEmbed-{{ section.id }}[data-gk-anim="true"] .gk-spotifyEmbed__frame{
      opacity: 0;
      transform: translateY(18px);
      will-change: transform, opacity;
    }

    #GK-SpotifyEmbed-{{ section.id }}.gk-in .gk-spotifyEmbed__eyebrow{
      opacity: 1; transform: translateY(0);
      transition: opacity 650ms cubic-bezier(.16,.84,.44,1) 60ms, transform 650ms cubic-bezier(.16,.84,.44,1) 60ms;
    }
    #GK-SpotifyEmbed-{{ section.id }}.gk-in .gk-spotifyEmbed__headRow{
      opacity: 1; transform: translateY(0);
      transition: opacity 650ms cubic-bezier(.16,.84,.44,1) 120ms, transform 650ms cubic-bezier(.16,.84,.44,1) 120ms;
    }
    #GK-SpotifyEmbed-{{ section.id }}.gk-in .gk-spotifyEmbed__sub{
      opacity: 1; transform: translateY(0);
      transition: opacity 650ms cubic-bezier(.16,.84,.44,1) 200ms, transform 650ms cubic-bezier(.16,.84,.44,1) 200ms;
    }
    #GK-SpotifyEmbed-{{ section.id }}.gk-in .gk-spotifyEmbed__frame{
      opacity: 1; transform: translateY(0);
      transition: opacity 650ms cubic-bezier(.16,.84,.44,1) 260ms, transform 900ms cubic-bezier(.16,.84,.44,1) 260ms;
    }

    @media (prefers-reduced-motion: reduce){
      #GK-SpotifyEmbed-{{ section.id }}[data-gk-anim="true"] .gk-spotifyEmbed__eyebrow,
      #GK-SpotifyEmbed-{{ section.id }}[data-gk-anim="true"] .gk-spotifyEmbed__headRow,
      #GK-SpotifyEmbed-{{ section.id }}[data-gk-anim="true"] .gk-spotifyEmbed__sub,
      #GK-SpotifyEmbed-{{ section.id }}[data-gk-anim="true"] .gk-spotifyEmbed__frame{
        opacity: 1 !important;
        transform: none !important;
        transition: none !important;
      }
    }
  </style>

  <script>
    (function(){
      var root = document.getElementById('GK-SpotifyEmbed-{{ section.id }}');
      if (!root) return;

      var animEnabled = root.getAttribute('data-gk-anim') === 'true';
      if (animEnabled && !(window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches)) {
        var revealed = false;
        var reveal = function(){
          if (revealed) return;
          revealed = true;
          root.classList.add('gk-in');
        };

        if ('IntersectionObserver' in window) {
          var io = new IntersectionObserver(function(entries){
            entries.forEach(function(entry){
              if (entry.isIntersecting) { reveal(); io.disconnect(); }
            });
          }, { threshold: 0.22 });
          io.observe(root);
        } else {
          requestAnimationFrame(reveal);
        }
      } else {
        root.classList.add('gk-in');
      }
    })();
  </script>
</section>

{% schema %}
{
  "name": "GK Spotify Embed",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "checkbox", "id": "enable_animation", "default": true, "label": "Enable fly-in animation" },

    { "type": "text", "id": "eyebrow", "label": "Eyebrow (optional)", "default": "." },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Listen on Spotify" },
    { "type": "text", "id": "subheading", "label": "Subheading (optional)", "default": "." },

    {
      "type": "text",
      "id": "embed_src",
      "label": "Spotify embed src URL",
      "default": "https://open.spotify.com/embed/artist/5Y6wPwVr2krTASRASpMLsC?utm_source=generator"
    },
    {
      "type": "text",
      "id": "open_url",
      "label": "Open on Spotify URL (optional)",
      "default": "https://open.spotify.com/artist/5Y6wPwVr2krTASRASpMLsC"
    },
    { "type": "checkbox", "id": "show_open_button", "default": true, "label": "Show \"Open on Spotify\" button" },

    { "type": "range", "id": "height", "min": 280, "max": 560, "step": 4, "unit": "px", "label": "Embed height", "default": 352 },

    { "type": "color", "id": "accent", "label": "Accent color", "default": "#E8690A" },

    { "type": "range", "id": "padding_top", "min": 0, "max": 140, "step": 4, "unit": "px", "label": "Padding top", "default": 44 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 140, "step": 4, "unit": "px", "label": "Padding bottom", "default": 52 }
  ],
  "presets": [
    { "name": "GK Spotify Embed" }
  ]
}
{% endschema %}